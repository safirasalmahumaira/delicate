{% extends 'base.html' %}
{% load static %}
{% load humanize %} 

{% block meta %}
    <title>Delicate - Skincare Store</title>
    <meta name="description" content="Delicate Skincare Store - Explore our range of skincare products.">
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
{% endblock meta %}


{% block content %}
{% include 'navbar.html' %}
  <h1>Welcome to Delicate - Home Page</h1>

<style>
  body {
      background-color: white;
  }

  /* Apply the animation to the product image */
  .product-img {
      animation: moveProduct 3s infinite ease-in-out;
  }

  /* Apply the animation to the product title and price */
  .product-title, .product-title-price {
      animation: moveTitlePrice 3s infinite ease-in-out;
  }

  /* General styles for the product card */
  .product-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
  }

  .product-img {
      border-radius: 8px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
  }


  /* Product title with custom background and alignment for catalog */
  .product-title {
      color: #B42857;
      font-weight: bold;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
  }

  /* Adjusted product-title-price class for the price to display on a new line */
  .product-title-price {
      display: block;
      margin-top: 4px;
      font-size: 0.875rem;
  }


  /* Add new item button styles */
  .add-new-item-btn {
      background-color: #f7838d;
      color: white;
      font-weight: bold;
      text-transform: uppercase;
      padding: 12px 24px;
      border-radius: 8px;
  }

  /* Last login text */
  .last-login {
      font-weight: bold;
      color: #FF1A9C;
  }

  /* Title and subtitle styles */
  .title {
      color: #FF1A9C;
  }

  .subtitle {
      color: #FF1A9C;
  }

  /* Custom style for BEST SELLER OF THE MONTH badge */
  .best-seller-badge {
      background-color: #FF1A9C;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 0.75rem;
  }

  /* Styles for the banner image */
  .banner {
      width: 100%;
      height: auto;
      margin-bottom: 20px; /* Jarak antara banner */
      border-radius: 8px;
      object-fit: cover;
  }

/* Layout grid untuk produk */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Card akan otomatis menyesuaikan lebar */
    gap: 20px;
    margin-top: 20px;
}

/* Card styling */
.product-card {
    border: none;
    border-radius: 8px;
    background-color: #FFC1E3; /* Pink lembut untuk seluruh bagian card */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.product-card:hover {
    transform: translateY(-5px); /* Sedikit animasi saat hover */
}

/* Card title section */
.card-top {
    background-color: #FF4DB2; /* Warna pink terang untuk judul */
    padding: 16px; /* Mengatur padding agar teks tidak terlalu dekat dengan tepi */
    color: white; /* Warna teks putih */
    font-weight: bold;
    text-align: center; /* Teks berada di tengah */
    width: 100%; /* Pastikan card-top mengisi penuh lebar card */
    border-top-left-radius: 8px; /* Menambahkan radius untuk pojok kiri atas */
    border-top-right-radius: 8px; /* Menambahkan radius untuk pojok kanan atas */
    box-sizing: border-box; /* Untuk memastikan padding dihitung dalam lebar total elemen */
}


/* Card bottom section */
.card-bottom {
    background-color: #FFC1E3; /* Warna pink lembut */
    padding: 16px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

/* Button styling */
button {
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.edit-button {
    background-color: #C5C6C7;
    color: white;
    margin-right: 8px;
}

.edit-button:hover {
    background-color: #93c5db;
}

.delete-button {
    background-color: #B42857;
    color: white;
}

.delete-button:hover {
    background-color: #ff4d6d;
}

/* Button container */
.button-container {
    display: flex;
    justify-content: flex-start;
    margin-top: 16px;
}

</style>

<div class="container mx-auto px-4 py-8 mt-16 max-w-7xl">
  <div class="flex justify-start items-center">
    <h1 class="title text-5xl italic font-bold mb-4">delicate</h1>
    <p class="subtitle text-lg font-bold ml-2">Cherish your delicate skin with love.</p>
  </div>

  <!-- Banner Section -->
  <div class="container mx-auto px-4">
    <img src="{% static 'css/image/banner_delicate.png' %}" class="banner" alt="Banner Delicate">
  </div>

  <div class="container mx-auto px-4">
    <img src="{% static 'css/image/banner_photoshoot.png' %}" class="banner" alt="Banner Photoshoot">
  </div>

  <div class="container mx-auto px-4">
    <img src="{% static 'css/image/banner_sale50.png' %}" class="banner" alt="Banner Sale50">
  </div>

  <div class="container mx-auto px-4">
    <img src="{% static 'css/image/banner_flashsale.png' %}" class="banner" alt="Banner Flashsale">
  </div>

  <!-- Product image section with animation -->
  <div class="flex justify-center items-center space-x-10 mb-6">
    <div class="product-card">
      <img src="{% static 'css/image/serum.jpeg' %}" class="product-img h-72 object-cover" alt="Serum">
      <a href="#" class="product-title block mt-4">Serum
        <span class="product-title-price">Rp250.000,00</span>
      </a>
    </div>

    <div class="product-card">
      <img src="{% static 'css/image/face_wash.jpeg' %}" class="product-img h-72 object-cover" alt="Facial Wash">
      <a href="#" class="product-title block mt-4">Facial Wash
        <span class="product-title-price">Rp200.000,00</span>
      </a>
    </div>

    <div class="product-card">
      <img src="{% static 'css/image/moisturizer.jpeg' %}" class="product-img h-72 object-cover" alt="Moisturizer">
      <a href="#" class="product-title block mt-4">Moisturizer
        <span class="product-title-price">Rp250.000,00</span>
      </a>
    </div>

    <div class="product-card relative">
      <img src="{% static 'css/image/liptint.jpeg' %}" class="product-img h-72 object-cover" alt="Lip Tint">
      <div class="best-seller-badge">BEST SELLER OF THE MONTH!</div>
      <a href="#" class="product-title block mt-4">Lip Tint
        <span class="product-title-price">Rp400.000,00</span>
      </a>
    </div>

    <div class="product-card">
      <img src="{% static 'css/image/blush.jpeg' %}" class="product-img h-72 object-cover" alt="Blush">
      <a href="#" class="product-title block mt-4">Blush
        <span class="product-title-price">Rp400.000,00</span>
      </a>
    </div>
  </div>

  <!-- Product cards section (the two-tone card layout) -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
    {% for item_entry in item_entries %}
    <div class="border border-gray-300 rounded-lg shadow-md">
      <!-- Upper section without background, name is styled for order section -->
      <div class="card-top">
        <h2 class="product-title-left text-white font-bold">{{ item_entry.name }}</h2>
      </div>
      
      <!-- Lower section with custom background and description -->
      <div class="card-bottom">
        <p><strong>Price:</strong> {{ item_entry.price }}</p>
        <p><strong>Description:</strong> {{ item_entry.description }}</p>
        <div class="flex justify-between mt-4">
          <a href="{% url 'main:edit_item' item_entry.pk %}">
            <button class="bg-[#C5C6C7] text-white py-1 px-3 rounded hover:bg-[#93c5db]">Edit</button>
          </a>
          <a href="{% url 'main:delete_item' item_entry.pk %}">
            <button class="bg-[#B42857] text-white py-1 px-3 rounded hover:bg-red-600">Delete</button>
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="product-grid" id="item_entry_cards"></div>

  <div id="item_entry_cards"></div>
  <div id="crudModal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 overflow-x-hidden overflow-y-auto transition-opacity duration-300 ease-out">
    <div id="crudModalContent" class="relative bg-white rounded-lg shadow-lg w-5/6 sm:w-3/4 md:w-1/2 lg:w-1/3 mx-4 sm:mx-0 transform scale-95 opacity-0 transition-transform transition-opacity duration-300 ease-out">
      <!-- Modal header -->
      <div class="flex items-center justify-between p-4 border-b rounded-t">
        <h3 class="text-xl font-semibold text-gray-900">
          Add New Item Entry
        </h3>
        <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center" id="closeModalBtn">
          <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <!-- Modal body -->
      <div class="px-6 py-4 space-y-6 form-style">
        <form id="itemEntryForm">
          <div class="mb-4">
            <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
            <input type="text" id="name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-[#FF1A9C]" placeholder="Enter product name" required>
          </div>
          <div class="mb-4">
            <label for="price" class="block text-sm font-medium text-gray-700">Price</label>
            <input type="number" id="price" name="price" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-[#FF1A9C]" placeholder="Enter product price" required></textarea>
          </div>
          <div class="mb-4">
            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
            <input type="text" id="description" name="description" class="mt-1 block w-full h-52 resize-none border border-gray-300 rounded-md p-2 hover:border-[#FF1A9C]" placeholder="Enter product description"  required>
          </div>
        </form>
      </div>
      <!-- Modal footer -->
      <div class="flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 p-6 border-t border-gray-200 rounded-b justify-center md:justify-end">
        <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg" id="cancelButton">Cancel</button>
        <button type="submit" id="submitItemEntry" form="itemEntryForm" class="bg-[#FF1A9C] hover:bg-[#C5C6C7] text-white font-bold py-2 px-4 rounded-lg">Save</button>
      </div>
    </div>
  </div>

  <!-- Add new item button -->
  <a href="{% url 'main:create_item_entry' %}" class="bg-[#FF1A9C] hover:bg-[#C5C6C7] text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105 mx-4 ">
      Add New Item
  </a>
  <button data-modal-target="crudModal" data-modal-toggle="crudModal" class="btn bg-[#FF1A9C] hover:bg-[#C5C6C7] text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105" onclick="showModal();">
    Add New Item by AJAX
  </button>

  <!-- Last login information -->
  <div class="text-left mt-8">
    <h5 class="last-login">Last login: {{ last_login }}</h5>
  </div>
</div>

<script>
async function getItemEntries() {
    return fetch("{% url 'main:show_json' %}").then((res) => res.json());
}

async function refreshItemEntries() {
    const itemEntries = await getItemEntries();
    const itemContainer = document.getElementById("item_entry_cards");
    itemContainer.innerHTML = ""; // Clear the container first

    if (itemEntries.length === 0) {
        itemContainer.innerHTML = `
            <div class="flex flex-col items-center justify-center min-h-[24rem] p-6">
                <img src="{% static 'image/none.jpeg' %}" alt="Sad face" class="w-32 h-32 mb-4"/>
                <p class="text-center text-gray-600 mt-4">Belum ada data item pada katalog.</p>
            </div>`;
    } else {
        // Loop through each item entry and create a product card dynamically
        itemEntries.forEach((item) => {
            const name = DOMPurify.sanitize(item.fields.name);
            const price = DOMPurify.sanitize(item.fields.price);
            const description = DOMPurify.sanitize(item.fields.description);
            const productCard = document.createElement("div");
            productCard.classList.add("product-card", "border", "border-gray-300", "rounded-lg", "shadow-md", "mb-4");

            // Add the card top with the product name
            const cardTop = document.createElement("div");
            cardTop.classList.add("card-top");
            cardTop.innerHTML = `<h2>${item.fields.name}</h2>`; // Assuming 'name' is the product field
            productCard.appendChild(cardTop);

            // Add the card bottom with price and description
            const cardBottom = document.createElement("div");
            cardBottom.classList.add("card-bottom");
            cardBottom.innerHTML = `
                <p><strong>Price:</strong> Rp${item.fields.price}</p>
                <p><strong>Description:</strong> ${item.fields.description}</p>
            `;
            productCard.appendChild(cardBottom);

            // Add edit and delete buttons
            const buttonContainer = document.createElement("div");
            buttonContainer.classList.add("flex", "justify-between", "mt-4");
            buttonContainer.innerHTML = `
                <a href="/edit-item/${item.pk}">
                    <button class="edit-button bg-[#C5C6C7] text-white py-1 px-3 rounded hover:bg-[#93c5db]">Edit</button>
                </a>
                <a href="/delete/${item.pk}">
                    <button class="delete-button bg-[#B42857] text-white py-1 px-3 rounded hover:bg-red-600">Delete</button>
                </a>
            `;
            productCard.appendChild(buttonContainer);

            // Append the product card to the main container
            itemContainer.appendChild(productCard);
        });
    }
}

// Call the function to load the entries dynamically
refreshItemEntries();

  const modal = document.getElementById('crudModal');
  const modalContent = document.getElementById('crudModalContent');

  function showModal() {
      const modal = document.getElementById('crudModal');
      const modalContent = document.getElementById('crudModalContent');

      modal.classList.remove('hidden'); 
      setTimeout(() => {
        modalContent.classList.remove('opacity-0', 'scale-95');
        modalContent.classList.add('opacity-100', 'scale-100');
      }, 50); 
  }

  function hideModal() {
      const modal = document.getElementById('crudModal');
      const modalContent = document.getElementById('crudModalContent');

      modalContent.classList.remove('opacity-100', 'scale-100');
      modalContent.classList.add('opacity-0', 'scale-95');

      setTimeout(() => {
        modal.classList.add('hidden');
      }, 150); 
  }

  document.getElementById("cancelButton").addEventListener("click", hideModal);
  document.getElementById("closeModalBtn").addEventListener("click", hideModal);

  function addItemEntry() {
    fetch("{% url 'main:add_item_entry_ajax' %}", {
      method: "POST",
      body: new FormData(document.querySelector('#itemEntryForm')),
    })
    .then(response => refreshItemEntries())

    document.getElementById("itemEntryForm").reset(); 
    document.querySelector("[data-modal-toggle='crudModal']").click();

    return false;
  }

  document.getElementById("itemEntryForm").addEventListener("submit", (e) => {
    e.preventDefault();
    addItemEntry();
  })
</script>

{% endblock content %}